import React, { Component } from 'react';
import { connect } from 'react-redux';
import { fetchPhones } from 'actions';
import { getPhones } from 'selectors';
import {
  Row, Col, Image, Caption,
} from 'styles';
import { Link } from 'react-router-dom';
import * as R from 'ramda';
import PropTypes from 'prop-types';

class PhoneList extends Component {
    static propTypes = {
      phones: PropTypes.arrayOf(),
    };

    static defaultProps = {
      phones: '',
    };

    componentDidMount() {
      const phones = this.props;
      phones.fetchPhones();
    }

    renderPhone = (phone, index) => {
      const shortDescription = `${R.take(60, phone.description)}...`;
      return (
        <Col key={index}>
          <Image
            src={phone.image}
            alt={phone.name}
          />
          <Caption>
            <h4>
$
              {phone.price}
            </h4>
            <h4>
              <Link to={`/phones/${phone.id}`}>
                {phone.name}
              </Link>
            </h4>
            <p>{shortDescription}</p>
          </Caption>
        </Col>
      );
    };

    render() {
      const { phones } = this.props;
      return (
        <div>
          <Row>
            {phones.map((phone, index) => this.renderPhone(phone, index))}
          </Row>
        </div>
      );
    }
}

const mapStateToProps = state => ({
  phones: getPhones(state),
});

const mapDispatchToProps = {
  fetchPhones,
};

export default connect(mapStateToProps, mapDispatchToProps)(PhoneList);
